<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PocketWatcher - Event Management Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        .gradient-bg { background: linear-gradient(180deg, #eadd66 0%, #a24b4b 100%); }
        .card-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .star-rating { color: #fbbf24; }
        .budget-progress { transition: width 0.3s ease; }
        .modal-backdrop { backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen" x-data="pocketWatcherApp()" x-init="init()">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-yellow-800">PocketWatcher</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Search Bar -->
                    <template x-if="isAuthenticated">
                        <div class="relative">
                            <input 
                                x-model="globalSearch.query" 
                                @input="performGlobalSearch()"
                                @focus="showSearchResults = true"
                                @blur="setTimeout(() => showSearchResults = false, 200)"
                                type="text" 
                                placeholder="Search vendors, venues, events..." 
                                class="w-64 px-4 py-2 pl-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            
                            <!-- Search Results Dropdown -->
                            <div x-show="showSearchResults && globalSearch.results" 
                                 x-cloak
                                 class="absolute top-full left-0 right-0 bg-white border rounded-lg shadow-lg mt-1 max-h-96 overflow-y-auto z-50">
                                <template x-if="globalSearch.results.vendors?.length > 0">
                                    <div class="p-2">
                                        <h3 class="font-bold text-sm text-gray-600 mb-2">Vendors</h3>
                                        <template x-for="vendor in globalSearch.results.vendors" :key="vendor._id">
                                            <div @click="viewVendorDetails(vendor)" class="p-2 hover:bg-gray-100 cursor-pointer rounded">
                                                <div class="font-medium" x-text="vendor.businessName || vendor.name"></div>
                                                <div class="text-sm text-gray-500" x-text="vendor.category"></div>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                                
                                <template x-if="globalSearch.results.venues?.length > 0">
                                    <div class="p-2 border-t">
                                        <h3 class="font-bold text-sm text-gray-600 mb-2">Venues</h3>
                                        <template x-for="venue in globalSearch.results.venues" :key="venue._id">
                                            <div @click="viewVenueDetails(venue)" class="p-2 hover:bg-gray-100 cursor-pointer rounded">
                                                <div class="font-medium" x-text="venue.name"></div>
                                                <div class="text-sm text-gray-500" x-text="venue.location.emirate"></div>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>

                    <template x-if="!isAuthenticated">
                        <div class="space-x-2">
                            <button @click="showLogin = true" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                Login
                            </button>
                            <button @click="showRegister = true" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                                Register
                            </button>
                        </div>
                    </template>
                    <template x-if="isAuthenticated">
                        <div class="flex items-center space-x-4">
                            <!-- Notifications -->
                            <div class="relative">
                                <button @click="showNotifications = !showNotifications" class="relative p-2 text-gray-600 hover:text-gray-800">
                                    <i class="fas fa-bell text-xl"></i>
                                    <template x-if="unreadNotifications > 0">
                                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center" x-text="unreadNotifications"></span>
                                    </template>
                                </button>
                                
                                <!-- Notifications Dropdown -->
                                <div x-show="showNotifications" 
                                     x-cloak
                                     @click.away="showNotifications = false"
                                     class="absolute right-0 mt-2 w-80 bg-white border rounded-lg shadow-lg z-50">
                                    <div class="p-4 border-b">
                                        <h3 class="font-bold">Notifications</h3>
                                    </div>
                                    <div class="max-h-64 overflow-y-auto">
                                        <template x-for="notification in notifications.slice(0, 10)" :key="notification.id">
                                            <div class="p-3 border-b hover:bg-gray-50 cursor-pointer">
                                                <p class="text-sm" x-text="notification.message"></p>
                                                <p class="text-xs text-gray-500 mt-1" x-text="formatDate(notification.createdAt)"></p>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <span class="text-gray-700">Welcome, <span x-text="user.name"></span></span>
                            <button @click="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                                Logout
                            </button>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-16">
        <!-- Landing Page -->
        <template x-if="!isAuthenticated">
            <div class="gradient-bg text-white py-20">
                <div class="max-w-7xl mx-auto px-4 text-center">
                    <h2 class="text-5xl font-bold mb-6">Connect. Plan. Celebrate.</h2>
                    <p class="text-xl mb-8">The UAE's premier event management platform connecting organizers with trusted vendors</p>
                    <div class="grid md:grid-cols-2 gap-8 mt-12">
                        <div class="bg-white/10 backdrop-blur-md rounded-lg p-6">
                            <i class="fas fa-calendar-alt text-4xl mb-4"></i>
                            <h3 class="text-2xl font-bold mb-2">For Event Organizers</h3>
                            <p>Plan your perfect event with budget management, vendor discovery, and seamless communication</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur-md rounded-lg p-6">
                            <i class="fas fa-store text-4xl mb-4"></i>
                            <h3 class="text-2xl font-bold mb-2">For Vendors</h3>
                            <p>Grow your business by connecting with event organizers across the UAE</p>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <!-- Dashboard -->
        <template x-if="isAuthenticated">
            <div class="max-w-7xl mx-auto px-4 py-8">
                <!-- Navigation Tabs -->
                <div class="flex space-x-4 mb-8 border-b overflow-x-auto">
                    <button @click="activeTab = 'dashboard'" 
                            :class="activeTab === 'dashboard' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500'"
                            class="border-b-2 px-4 py-2 font-medium whitespace-nowrap">
                        Dashboard
                    </button>
                    <template x-if="user.userType === 'organizer'">
                        <button @click="activeTab = 'events'" 
                                :class="activeTab === 'events' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500'"
                                class="border-b-2 px-4 py-2 font-medium whitespace-nowrap">
                            My Events
                        </button>
                    </template>
                    <button @click="activeTab = 'vendors'" 
                            :class="activeTab === 'vendors' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500'"
                            class="border-b-2 px-4 py-2 font-medium whitespace-nowrap">
                        <span x-text="user.userType === 'organizer' ? 'Find Vendors' : 'My Profile'"></span>
                    </button>
                    <button @click="activeTab = 'venues'" 
                            :class="activeTab === 'venues' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500'"
                            class="border-b-2 px-4 py-2 font-medium whitespace-nowrap">
                        Venues
                    </button>
                    <button @click="activeTab = 'messages'" 
                            :class="activeTab === 'messages' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500'"
                            class="border-b-2 px-4 py-2 font-medium whitespace-nowrap">
                        Messages
                    </button>
                    <template x-if="user.userType === 'vendor'">
                        <button @click="activeTab = 'requests'" 
                                :class="activeTab === 'requests' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500'"
                                class="border-b-2 px-4 py-2 font-medium whitespace-nowrap">
                            Requests
                        </button>
                    </template>
                </div>

                <!-- Dashboard Tab -->
                <div x-show="activeTab === 'dashboard'" x-cloak>
                    <h2 class="text-3xl font-bold mb-6">Dashboard</h2>
                    
                    <!-- Analytics Cards -->
                    <div class="grid md:grid-cols-4 gap-6 mb-8">
                        <template x-for="(stat, key) in analytics" :key="key">
                            <div class="bg-white rounded-lg card-shadow p-6 hover:shadow-lg transition-shadow">
                                <div class="text-2xl font-bold text-yellow-600" x-text="stat.value"></div>
                                <div class="text-gray-600" x-text="stat.label"></div>
                            </div>
                        </template>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white rounded-lg card-shadow p-6 mb-8">
                        <h3 class="text-xl font-bold mb-4">Quick Actions</h3>
                        <div class="grid md:grid-cols-4 gap-4">
                            <template x-if="user.userType === 'organizer'">
                                <button @click="showCreateEvent = true" class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition-colors">
                                    <i class="fas fa-plus mr-2"></i>Create Event
                                </button>
                            </template>
                            <button @click="activeTab = 'vendors'" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-search mr-2"></i>Find Vendors
                            </button>
                            <button @click="activeTab = 'venues'" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors">
                                <i class="fas fa-building mr-2"></i>Browse Venues
                            </button>
                            <button @click="loadBudgetRecommendations()" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors">
                                <i class="fas fa-chart-line mr-2"></i>Budget Guide
                            </button>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="bg-white rounded-lg card-shadow p-6">
                        <h3 class="text-xl font-bold mb-4">Recent Activity</h3>
                        <div class="space-y-4">
                            <template x-for="notification in notifications.slice(0, 5)" :key="notification.id">
                                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-bell text-yellow-600"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-gray-800" x-text="notification.message"></p>
                                        <p class="text-sm text-gray-500" x-text="formatDate(notification.createdAt)"></p>
                                    </div>
                                </div>
                            </template>
                            <template x-if="notifications.length === 0">
                                <div class="text-center text-gray-500 py-8">
                                    <i class="fas fa-bell-slash text-4xl mb-4"></i>
                                    <p>No recent activity</p>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Events Tab -->
                <div x-show="activeTab === 'events'" x-cloak>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold">My Events</h2>
                        <button @click="showCreateEvent = true" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                            <i class="fas fa-plus mr-2"></i>Create Event
                        </button>
                    </div>

                    <div class="grid gap-6">
                        <template x-for="event in events" :key="event._id">
                            <div class="bg-white rounded-lg card-shadow p-6 hover:shadow-lg transition-shadow">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold" x-text="event.title"></h3>
                                        <p class="text-gray-600" x-text="event.description"></p>
                                        <div class="flex items-center mt-2 space-x-4 flex-wrap">
                                            <span class="text-sm text-gray-500">
                                                <i class="fas fa-calendar mr-1"></i>
                                                <span x-text="formatDate(event.date.start)"></span>
                                            </span>
                                            <span class="text-sm text-gray-500">
                                                <i class="fas fa-users mr-1"></i>
                                                <span x-text="event.attendees.expected + ' expected'"></span>
                                            </span>
                                            <span class="text-sm text-gray-500">
                                                <i class="fas fa-dollar-sign mr-1"></i>
                                                <span x-text="'AED ' + event.totalBudget.toLocaleString()"></span>
                                            </span>
                                            <span class="text-sm text-gray-500">
                                                <i class="fas fa-map-marker-alt mr-1"></i>
                                                <span x-text="event.location?.address || 'Location TBD'"></span>
                                            </span>
                                        </div>
                                    </div>
                                    <span :class="getStatusColor(event.status)" class="px-3 py-1 rounded-full text-sm font-medium capitalize" x-text="event.status"></span>
                                </div>
                                
                                <!-- Budget Progress -->
                                <div class="mb-4">
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Budget Used</span>
                                        <span x-text="calculateBudgetUsed(event) + '%'"></span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-yellow-600 h-2 rounded-full budget-progress" :style="'width: ' + Math.min(calculateBudgetUsed(event), 100) + '%'"></div>
                                    </div>
                                </div>

                                <!-- Vendor Requests Summary -->
                                <template x-if="event.vendorRequests && event.vendorRequests.length > 0">
                                    <div class="mb-4">
                                        <div class="text-sm text-gray-600 mb-2">Vendor Requests:</div>
                                        <div class="flex space-x-2">
                                            <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">
                                                <span x-text="event.vendorRequests.filter(vr => vr.status === 'pending').length"></span> Pending
                                            </span>
                                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">
                                                <span x-text="event.vendorRequests.filter(vr => vr.status === 'accepted').length"></span> Accepted
                                            </span>
                                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">
                                                <span x-text="event.vendorRequests.filter(vr => vr.status === 'completed').length"></span> Completed
                                            </span>
                                        </div>
                                    </div>
                                </template>

                                <div class="flex space-x-2">
                                    <button @click="viewEventDetails(event)" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                                        View Details
                                    </button>
                                    <button @click="editEvent(event)" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
                                        Edit
                                    </button>
                                    <button @click="getBudgetRecommendations(event)" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700">
                                        Budget Guide
                                    </button>
                                </div>
                            </div>
                        </template>
                        <template x-if="events.length === 0">
                            <div class="text-center text-gray-500 py-12">
                                <i class="fas fa-calendar-plus text-6xl mb-4"></i>
                                <h3 class="text-xl font-medium mb-2">No events yet</h3>
                                <p class="mb-4">Create your first event to get started</p>
                                <button @click="showCreateEvent = true" class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700">
                                    Create Event
                                </button>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Vendors Tab -->
                <div x-show="activeTab === 'vendors'" x-cloak>
                    <h2 class="text-3xl font-bold mb-6">
                        <span x-text="user.userType === 'organizer' ? 'Find Vendors' : 'My Profile'"></span>
                    </h2>

                    <!-- Vendor Search (for organizers) -->
                    <template x-if="user.userType === 'organizer'">
                        <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                            <div class="grid md:grid-cols-5 gap-4">
                                <input x-model="vendorSearch.query" @input="searchVendors()" type="text" placeholder="Search vendors..." class="border rounded-lg px-3 py-2">
                                <select x-model="vendorSearch.category" @change="searchVendors()" class="border rounded-lg px-3 py-2">
                                    <option value="">All Categories</option>
                                    <option value="catering">Catering</option>
                                    <option value="photography">Photography</option>
                                    <option value="decoration">Decoration</option>
                                    <option value="entertainment">Entertainment</option>
                                    <option value="audio_visual">Audio Visual</option>
                                    <option value="flowers">Flowers</option>
                                    <option value="transportation">Transportation</option>
                                    <option value="security">Security</option>
                                    <option value="venue">Venue</option>
                                    <option value="other">Other</option>
                                </select>
                                <select x-model="vendorSearch.emirate" @change="searchVendors()" class="border rounded-lg px-3 py-2">
                                    <option value="">All Emirates</option>
                                    <option value="Dubai">Dubai</option>
                                    <option value="Abu Dhabi">Abu Dhabi</option>
                                    <option value="Sharjah">Sharjah</option>
                                    <option value="Ajman">Ajman</option>
                                    <option value="Ras Al Khaimah">Ras Al Khaimah</option>
                                    <option value="Fujairah">Fujairah</option>
                                    <option value="Umm Al Quwain">Umm Al Quwain</option>
                                </select>
                                <input x-model="vendorSearch.priceMin" @input="searchVendors()" type="number" placeholder="Min Price" class="border rounded-lg px-3 py-2">
                                <button @click="searchVendors()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                    <i class="fas fa-search mr-2"></i>Search
                                </button>
                            </div>
                        </div>
                    </template>

                    <!-- Vendor Profile (for vendors) -->
                    <template x-if="user.userType === 'vendor'">
                        <div class="space-y-6">
                            <!-- Basic Profile -->
                            <div class="bg-white rounded-lg card-shadow p-6">
                                <h3 class="text-xl font-bold mb-4">Business Profile</h3>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Business Name</label>
                                        <input x-model="user.businessName" type="text" class="w-full border rounded-lg px-3 py-2">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Category</label>
                                        <select x-model="user.category" class="w-full border rounded-lg px-3 py-2">
                                            <option value="catering">Catering</option>
                                            <option value="photography">Photography</option>
                                            <option value="decoration">Decoration</option>
                                            <option value="entertainment">Entertainment</option>
                                            <option value="audio_visual">Audio Visual</option>
                                            <option value="flowers">Flowers</option>
                                            <option value="transportation">Transportation</option>
                                            <option value="security">Security</option>
                                            <option value="venue">Venue</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium mb-2">Bio</label>
                                        <textarea x-model="user.profile.bio" rows="3" class="w-full border rounded-lg px-3 py-2" placeholder="Tell potential clients about your business..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Phone</label>
                                        <input x-model="user.profile.phone" type="tel" class="w-full border rounded-lg px-3 py-2">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">WhatsApp</label>
                                        <input x-model="user.profile.whatsapp" type="tel" class="w-full border rounded-lg px-3 py-2">
                                    </div>
                                </div>
                                <button @click="updateProfile()" class="mt-4 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                    <i class="fas fa-save mr-2"></i>Update Profile
                                </button>
                            </div>

                            <!-- Services & Pricing -->
                            <div class="bg-white rounded-lg card-shadow p-6">
                                <h3 class="text-xl font-bold mb-4">Services & Pricing</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Services Offered</label>
                                        <div class="flex flex-wrap gap-2 mb-2">
                                            <template x-for="(service, index) in (user.services || [])" :key="index">
                                                <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm flex items-center">
                                                    <span x-text="service"></span>
                                                    <button @click="removeService(index)" class="ml-2 text-yellow-600 hover:text-yellow-800">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </span>
                                            </template>
                                        </div>
                                        <div class="flex gap-2">
                                            <input x-model="newService" @keyup.enter="addService()" type="text" placeholder="Add a service..." class="flex-1 border rounded-lg px-3 py-2">
                                            <button @click="addService()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                                Add
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Price Range (Min AED)</label>
                                            <input x-model="user.pricing.priceRange.min" type="number" class="w-full border rounded-lg px-3 py-2">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Price Range (Max AED)</label>
                                            <input x-model="user.pricing.priceRange.max" type="number" class="w-full border rounded-lg px-3 py-2">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Portfolio -->
                            <div class="bg-white rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-xl font-bold">Portfolio</h3>
                                    <button @click="showAddPortfolio = true" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                        <i class="fas fa-plus mr-2"></i>Add Work
                                    </button>
                                </div>
                                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <template x-for="(work, index) in (user.portfolio || [])" :key="index">
                                        <div class="border rounded-lg p-4">
                                            <div class="h-32 bg-gray-200 rounded-lg mb-3 flex items-center justify-center">
                                                <i class="fas fa-image text-gray-400 text-2xl"></i>
                                            </div>
                                            <h4 class="font-medium" x-text="work.title"></h4>
                                            <p class="text-sm text-gray-600" x-text="work.description"></p>
                                            <p class="text-xs text-gray-500 mt-2" x-text="formatDate(work.date)"></p>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Reviews -->
                            <div class="bg-white rounded-lg card-shadow p-6">
                                <h3 class="text-xl font-bold mb-4">Customer Reviews</h3>
                                <div class="space-y-4">
                                    <template x-for="review in vendorReviews" :key="review._id">
                                        <div class="border rounded-lg p-4">
                                            <div class="flex items-start justify-between mb-2">
                                                <div>
                                                    <div class="flex items-center mb-1">
                                                        <div class="flex star-rating">
                                                            <template x-for="i in 5" :key="i">
                                                                <i :class="i <= review.rating ? 'fas fa-star' : 'far fa-star'"></i>
                                                            </template>
                                                        </div>
                                                        <span class="ml-2 font-medium" x-text="review.reviewer.name"></span>
                                                    </div>
                                                    <p class="text-gray-600" x-text="review.comment"></p>
                                                </div>
                                                <span class="text-sm text-gray-500" x-text="formatDate(review.createdAt)"></span>
                                            </div>
                                            <template x-if="review.response">
                                                <div class="mt-3 bg-gray-50 rounded p-3">
                                                    <p class="text-sm"><strong>Response:</strong> <span x-text="review.response.content"></span></p>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Vendor List (for organizers) -->
                    <template x-if="user.userType === 'organizer'">
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <template x-for="vendor in vendors" :key="vendor._id">
                                <div class="bg-white rounded-lg card-shadow p-6 hover:shadow-lg transition-shadow">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex-1">
                                            <h3 class="text-lg font-bold" x-text="vendor.businessName || vendor.name"></h3>
                                            <p class="text-gray-600 capitalize" x-text="vendor.category?.replace('_', ' ')"></p>
                                            <div class="flex items-center mt-1">
                                                <div class="flex star-rating">
                                                    <template x-for="i in 5" :key="i">
                                                        <i :class="i <= vendor.rating.average ? 'fas fa-star' : 'far fa-star'"></i>
                                                    </template>
                                                </div>
                                                <span class="text-sm text-gray-500 ml-2">
                                                    (<span x-text="vendor.rating.count"></span> reviews)
                                                </span>
                                            </div>
                                        </div>
                                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm" x-text="vendor.location.emirate"></span>
                                    </div>
                                    
                                    <p class="text-gray-600 text-sm mb-4" x-text="vendor.profile?.bio || 'Professional service provider'"></p>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-medium mb-2">Services:</h4>
                                        <div class="flex flex-wrap gap-1">
                                            <template x-for="service in vendor.services?.slice(0, 3)" :key="service">
                                                <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs" x-text="service"></span>
                                            </template>
                                            <template x-if="vendor.services?.length > 3">
                                                <span class="text-xs text-gray-500">+<span x-text="vendor.services.length - 3"></span> more</span>
                                            </template>
                                        </div>
                                    </div>

                                    <template x-if="vendor.pricing?.priceRange?.min">
                                        <div class="mb-4 text-sm text-gray-600">
                                            <i class="fas fa-dollar-sign mr-1"></i>
                                            AED <span x-text="vendor.pricing.priceRange.min.toLocaleString()"></span>
                                            <template x-if="vendor.pricing.priceRange.max">
                                                - <span x-text="vendor.pricing.priceRange.max.toLocaleString()"></span>
                                            </template>
                                        </div>
                                    </template>

                                    <div class="flex space-x-2">
                                        <button @click="viewVendorDetails(vendor)" class="flex-1 bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
                                            View Profile
                                        </button>
                                        <button @click="contactVendor(vendor)" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                                            <i class="fas fa-message"></i>
                                        </button>
                                        <button @click="requestVendor(vendor)" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700">
                                            <i class="fas fa-handshake"></i>
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>

                <!-- Venues Tab -->
                <div x-show="activeTab === 'venues'" x-cloak>
                    <h2 class="text-3xl font-bold mb-6">Available Venues</h2>

                    <!-- Venue Search -->
                    <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                        <div class="grid md:grid-cols-5 gap-4">
                            <select x-model="venueSearch.emirate" @change="searchVenues()" class="border rounded-lg px-3 py-2">
                                <option value="">All Emirates</option>
                                <option value="Dubai">Dubai</option>
                                <option value="Abu Dhabi">Abu Dhabi</option>
                                <option value="Sharjah">Sharjah</option>
                                <option value="Ajman">Ajman</option>
                                <option value="Ras Al Khaimah">Ras Al Khaimah</option>
                                <option value="Fujairah">Fujairah</option>
                                <option value="Umm Al Quwain">Umm Al Quwain</option>
                            </select>
                            <select x-model="venueSearch.type" @change="searchVenues()" class="border rounded-lg px-3 py-2">
                                <option value="">All Types</option>
                                <option value="hotel">Hotel</option>
                                <option value="restaurant">Restaurant</option>
                                <option value="hall">Hall</option>
                                <option value="outdoor">Outdoor</option>
                                <option value="beach">Beach</option>
                                <option value="mall">Mall</option>
                                <option value="office">Office</option>
                                <option value="home">Home</option>
                                <option value="other">Other</option>
                            </select>
                            <input x-model="venueSearch.minCapacity" @input="searchVenues()" type="number" placeholder="Min Capacity" class="border rounded-lg px-3 py-2">
                            <input x-model="venueSearch.maxCapacity" @input="searchVenues()" type="number" placeholder="Max Capacity" class="border rounded-lg px-3 py-2">
                            <button @click="searchVenues()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                <i class="fas fa-search mr-2"></i>Search
                            </button>
                        </div>
                    </div>

                    <!-- Venue List -->
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
    <template x-for="venue in venues" :key="venue._id">
        <div class="bg-white rounded-lg card-shadow overflow-hidden hover:shadow-lg transition-shadow">
            <!-- Venue Image Carousel -->
            <div class="relative h-48 bg-gray-200" x-data="{ currentImage: 0 }">
                <template x-if="venue.images && venue.images.length > 0">
                    <div class="relative h-full overflow-hidden">
                        <img :src="venue.images[currentImage].url" 
                             :alt="venue.images[currentImage].caption"
                             class="w-full h-full object-cover">
                        
                        <!-- Image Navigation -->
                        <template x-if="venue.images.length > 1">
                            <div class="absolute inset-0 flex items-center justify-between p-2">
                                <button @click="currentImage = currentImage > 0 ? currentImage - 1 : venue.images.length - 1"
                                        class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-opacity">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button @click="currentImage = currentImage < venue.images.length - 1 ? currentImage + 1 : 0"
                                        class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-opacity">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </template>
                        
                        <!-- Image Indicators -->
                        <template x-if="venue.images.length > 1">
                            <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-2">
                                <template x-for="(image, index) in venue.images" :key="index">
                                    <button @click="currentImage = index"
                                            :class="currentImage === index ? 'bg-white' : 'bg-white bg-opacity-50'"
                                            class="w-2 h-2 rounded-full transition-all">
                                    </button>
                                </template>
                            </div>
                        </template>
                    </div>
                </template>
                
                <!-- Fallback if no images -->
                <template x-if="!venue.images || venue.images.length === 0">
                    <div class="h-full bg-gradient-to-br from-yellow-400 to-purple-500 flex items-center justify-center">
                        <i class="fas fa-building text-white text-4xl"></i>
                    </div>
                </template>
            </div>
            
            <div class="p-6">
                <div class="flex items-start justify-between mb-2">
                    <h3 class="text-lg font-bold" x-text="venue.name"></h3>
                    <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm" x-text="venue.location.emirate"></span>
                </div>
                
                <p class="text-gray-600 text-sm mb-3" x-text="venue.description"></p>
                
                <div class="space-y-2 text-sm">
                    <div class="flex items-center">
                        <i class="fas fa-users text-gray-400 w-4"></i>
                        <span class="ml-2" x-text="venue.capacity.minimum + ' - ' + venue.capacity.maximum + ' guests'"></span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-dollar-sign text-gray-400 w-4"></i>
                        <span class="ml-2" x-text="'AED ' + venue.pricing.basePrice.toLocaleString() + ' ' + venue.pricing.priceType.replace('_', ' ')"></span>
                    </div>
                    <div class="flex items-center">
                        <div class="flex star-rating">
                            <template x-for="i in 5" :key="i">
                                <i :class="i <= venue.rating.average ? 'fas fa-star' : 'far fa-star'" class="text-xs"></i>
                            </template>
                        </div>
                        <span class="text-gray-500 ml-2">(<span x-text="venue.rating.count"></span>)</span>
                    </div>
                    <template x-if="venue.amenities && venue.amenities.length > 0">
                        <div class="flex items-start">
                            <i class="fas fa-check text-gray-400 w-4 mt-0.5"></i>
                            <span class="ml-2" x-text="venue.amenities.slice(0, 3).join(', ')"></span>
                        </div>
                    </template>
                </div>

                <button @click="viewVenueDetails(venue)" class="w-full mt-4 bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
                    View Details
                </button>
            </div>
        </div>
    </template>
</div>

<!-- Updated Venue Details Modal with Image Gallery -->
<div x-show="showVenueDetails" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto" @click.away="showVenueDetails = false">
        <template x-if="selectedVenue">
            <div>
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-3xl font-bold" x-text="selectedVenue.name"></h2>
                        <p class="text-gray-600 capitalize" x-text="selectedVenue.venueType"></p>
                        <div class="flex items-center mt-2">
                            <div class="flex star-rating">
                                <template x-for="i in 5" :key="i">
                                    <i :class="i <= selectedVenue.rating.average ? 'fas fa-star' : 'far fa-star'"></i>
                                </template>
                            </div>
                            <span class="ml-2 text-gray-600">(<span x-text="selectedVenue.rating.count"></span> reviews)</span>
                        </div>
                    </div>
                    <button @click="showVenueDetails = false" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-2 space-y-6">
                        <!-- Image Gallery -->
                        <div x-data="{ currentImage: 0 }" class="space-y-4">
                            <template x-if="selectedVenue.images && selectedVenue.images.length > 0">
                                <div>
                                    <!-- Main Image -->
                                    <div class="relative h-64 bg-gray-200 rounded-lg overflow-hidden">
                                        <img :src="selectedVenue.images[currentImage].url" 
                                             :alt="selectedVenue.images[currentImage].caption"
                                             class="w-full h-full object-cover">
                                        
                                        <!-- Navigation buttons -->
                                        <template x-if="selectedVenue.images.length > 1">
                                            <div class="absolute inset-0 flex items-center justify-between p-4">
                                                <button @click="currentImage = currentImage > 0 ? currentImage - 1 : selectedVenue.images.length - 1"
                                                        class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70">
                                                    <i class="fas fa-chevron-left"></i>
                                                </button>
                                                <button @click="currentImage = currentImage < selectedVenue.images.length - 1 ? currentImage + 1 : 0"
                                                        class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70">
                                                    <i class="fas fa-chevron-right"></i>
                                                </button>
                                            </div>
                                        </template>
                                        
                                        <!-- Image caption -->
                                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4">
                                            <p class="text-white text-sm" x-text="selectedVenue.images[currentImage].caption"></p>
                                        </div>
                                    </div>
                                    
                                    <!-- Thumbnail Strip -->
                                    <template x-if="selectedVenue.images.length > 1">
                                        <div class="flex space-x-2 overflow-x-auto pb-2">
                                            <template x-for="(image, index) in selectedVenue.images" :key="index">
                                                <button @click="currentImage = index"
                                                        :class="currentImage === index ? 'ring-2 ring-yellow-500' : 'ring-1 ring-gray-300'"
                                                        class="flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden">
                                                    <img :src="image.url" :alt="image.caption" class="w-full h-full object-cover">
                                                </button>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </template>
                            
                            <!-- Fallback if no images -->
                            <template x-if="!selectedVenue.images || selectedVenue.images.length === 0">
                                <div class="h-64 bg-gradient-to-br from-yellow-400 to-purple-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-building text-white text-6xl"></i>
                                </div>
                            </template>
                        </div>

                        <!-- Description -->
                        <div>
                            <h3 class="text-xl font-bold mb-3">Description</h3>
                            <p class="text-gray-600" x-text="selectedVenue.description"></p>
                        </div>

                        <!-- Amenities -->
                        <template x-if="selectedVenue.amenities && selectedVenue.amenities.length > 0">
                            <div>
                                <h3 class="text-xl font-bold mb-3">Amenities</h3>
                                <div class="grid grid-cols-2 gap-2">
                                    <template x-for="amenity in selectedVenue.amenities" :key="amenity">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-check text-green-500"></i>
                                            <span class="text-sm" x-text="amenity"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Venue Details Sidebar -->
                    <div class="space-y-6">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-bold mb-3">Venue Details</h3>
                            <div class="space-y-2 text-sm">
                                <div><span class="text-gray-600">Location:</span> <span x-text="selectedVenue.location.emirate"></span></div>
                                <div><span class="text-gray-600">Address:</span> <span x-text="selectedVenue.location.address"></span></div>
                                <div><span class="text-gray-600">Capacity:</span> <span x-text="selectedVenue.capacity.minimum + ' - ' + selectedVenue.capacity.maximum + ' guests'"></span></div>
                                <div><span class="text-gray-600">Type:</span> <span class="capitalize" x-text="selectedVenue.venueType"></span></div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-bold mb-3">Pricing</h3>
                            <div class="text-lg font-medium">
                                AED <span x-text="selectedVenue.pricing.basePrice.toLocaleString()"></span>
                                <span class="text-sm text-gray-600" x-text="'per ' + selectedVenue.pricing.priceType.replace('_', ' ')"></span>
                            </div>
                        </div>

                        <template x-if="selectedVenue.contact">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="font-bold mb-3">Contact</h3>
                                <div class="space-y-2 text-sm">
                                    <template x-if="selectedVenue.contact.manager">
                                        <div><span class="text-gray-600">Manager:</span> <span x-text="selectedVenue.contact.manager"></span></div>
                                    </template>
                                    <template x-if="selectedVenue.contact.phone">
                                        <div><span class="text-gray-600">Phone:</span> <span x-text="selectedVenue.contact.phone"></span></div>
                                    </template>
                                    <template x-if="selectedVenue.contact.email">
                                        <div><span class="text-gray-600">Email:</span> <span x-text="selectedVenue.contact.email"></span></div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <div class="space-y-3">
                            <button @click="bookVenue(selectedVenue)" class="w-full bg-yellow-600 text-white px-4 py-3 rounded-lg hover:bg-yellow-700">
                                <i class="fas fa-calendar-check mr-2"></i>Book Venue
                            </button>
                            <button @click="contactVenueManager(selectedVenue)" class="w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700">
                                <i class="fas fa-phone mr-2"></i>Contact Manager
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>
</div>

                <!-- Messages Tab -->
                <div x-show="activeTab === 'messages'" x-cloak>
                    <h2 class="text-3xl font-bold mb-6">Messages</h2>
                    
                    <div class="grid md:grid-cols-3 gap-6">
                        <!-- Conversations List -->
                        <div class="bg-white rounded-lg card-shadow p-4">
                            <h3 class="font-bold mb-4">Conversations</h3>
                            <div class="space-y-2">
                                <template x-for="conversation in conversations" :key="conversation._id">
                                    <div @click="selectConversation(conversation)" 
                                         :class="selectedConversation?._id === conversation._id ? 'bg-yellow-50 border-yellow-200' : 'bg-gray-50'"
                                         class="p-3 rounded-lg cursor-pointer border hover:bg-gray-100 transition-colors">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-yellow-600 rounded-full flex items-center justify-center text-white font-bold">
                                                <span x-text="(conversation.participant.businessName || conversation.participant.name).charAt(0)"></span>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <p class="font-medium truncate" x-text="conversation.participant.businessName || conversation.participant.name"></p>
                                                <p class="text-sm text-gray-500 truncate" x-text="conversation.lastMessage.content"></p>
                                            </div>
                                            <template x-if="conversation.unreadCount > 0">
                                                <span class="bg-red-500 text-white text-xs rounded-full px-2 py-1" x-text="conversation.unreadCount"></span>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                                <template x-if="conversations.length === 0">
                                    <div class="text-center text-gray-500 py-8">
                                        <i class="fas fa-comments text-4xl mb-4"></i>
                                        <p>No conversations yet</p>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Chat Area -->
                        <div class="md:col-span-2 bg-white rounded-lg card-shadow flex flex-col h-96">
                            <template x-if="selectedConversation">
                                <div class="flex flex-col h-full">
                                    <!-- Chat Header -->
                                    <div class="p-4 border-b">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h3 class="font-bold" x-text="selectedConversation.participant.businessName || selectedConversation.participant.name"></h3>
                                                <p class="text-sm text-gray-500" x-text="selectedConversation.participant.userType"></p>
                                            </div>
                                            <button @click="showQuoteModal = true" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                                <i class="fas fa-file-invoice-dollar mr-1"></i>Send Quote
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Messages -->
                                    <div class="flex-1 p-4 overflow-y-auto space-y-3" id="messagesContainer">
                                        <template x-for="message in currentMessages" :key="message._id">
                                            <div :class="message.sender._id === user.id ? 'ml-auto' : 'mr-auto'"
                                                 class="max-w-xs">
                                                <div :class="message.sender._id === user.id ? 'bg-yellow-600 text-white' : 'bg-gray-200 text-gray-800'"
                                                     class="px-4 py-2 rounded-lg">
                                                    <p x-text="message.content"></p>
                                                    <template x-if="message.messageType === 'quote' && message.quotation">
                                                        <div class="mt-2 p-2 bg-white/20 rounded">
                                                            <p class="font-bold">Quote: AED <span x-text="message.quotation.totalPrice"></span></p>
                                                            <p class="text-xs">Valid until: <span x-text="formatDate(message.quotation.validUntil)"></span></p>
                                                        </div>
                                                    </template>
                                                    <p class="text-xs opacity-75 mt-1" x-text="formatDate(message.createdAt)"></p>
                                                </div>
                                            </div>
                                        </template>
                                    </div>

                                    <!-- Message Input -->
                                    <div class="p-4 border-t">
                                        <div class="flex space-x-2">
                                            <input x-model="newMessage" @keyup.enter="sendMessage()" 
                                                   type="text" placeholder="Type a message..." 
                                                   class="flex-1 border rounded-lg px-3 py-2">
                                            <button @click="showFileUpload = true" class="bg-gray-600 text-white px-3 py-2 rounded-lg hover:bg-gray-700">
                                                <i class="fas fa-paperclip"></i>
                                            </button>
                                            <button @click="sendMessage()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                                Send
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <template x-if="!selectedConversation">
                                <div class="flex items-center justify-center h-full text-gray-500">
                                    <div class="text-center">
                                        <i class="fas fa-comments text-4xl mb-4"></i>
                                        <p>Select a conversation to start messaging</p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Vendor Requests Tab (for vendors) -->
                <div x-show="activeTab === 'requests'" x-cloak>
                    <h2 class="text-3xl font-bold mb-6">Event Requests</h2>
                    
                    <div class="space-y-6">
                        <template x-for="request in vendorRequests" :key="request.eventId + request.requestId">
                            <div class="bg-white rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold" x-text="request.event.title"></h3>
                                        <p class="text-gray-600" x-text="request.event.description"></p>
                                        <div class="flex items-center mt-2 space-x-4">
                                            <span class="text-sm text-gray-500">
                                                <i class="fas fa-user mr-1"></i>
                                                <span x-text="request.event.organizer.name"></span>
                                            </span>
                                            <span class="text-sm text-gray-500">
                                                <i class="fas fa-calendar mr-1"></i>
                                                <span x-text="formatDate(request.event.date.start)"></span>
                                            </span>
                                            <span class="text-sm text-gray-500">
                                                <i class="fas fa-users mr-1"></i>
                                                <span x-text="request.event.attendees.expected + ' guests'"></span>
                                            </span>
                                        </div>
                                    </div>
                                    <span :class="getRequestStatusColor(request.status)" 
                                          class="px-3 py-1 rounded-full text-sm font-medium capitalize" 
                                          x-text="request.status"></span>
                                </div>

                                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                    <h4 class="font-medium mb-2">Request Details:</h4>
                                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <span class="text-gray-600">Service:</span>
                                            <span class="ml-2 font-medium" x-text="request.service"></span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">Requested Price:</span>
                                            <span class="ml-2 font-medium">AED <span x-text="request.requestedPrice?.toLocaleString() || 'Not specified'"></span></span>
                                        </div>
                                        <template x-if="request.notes">
                                            <div class="md:col-span-2">
                                                <span class="text-gray-600">Notes:</span>
                                                <p class="mt-1" x-text="request.notes"></p>
                                            </div>
                                        </template>
                                    </div>
                                </div>

                                <template x-if="request.status === 'pending'">
                                    <div class="flex space-x-3">
                                        <button @click="respondToRequest(request, 'accepted')" 
                                                class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                                            <i class="fas fa-check mr-2"></i>Accept
                                        </button>
                                        <button @click="respondToRequest(request, 'declined')" 
                                                class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                                            <i class="fas fa-times mr-2"></i>Decline
                                        </button>
                                        <button @click="showQuoteResponse(request)" 
                                                class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
                                            <i class="fas fa-quote-right mr-2"></i>Send Quote
                                        </button>
                                    </div>
                                </template>

                                <template x-if="request.quotedPrice && request.status === 'accepted'">
                                    <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                                        <p class="text-green-800">
                                            <i class="fas fa-check-circle mr-2"></i>
                                            Quoted Price: AED <span x-text="request.quotedPrice.toLocaleString()"></span>
                                        </p>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <template x-if="vendorRequests.length === 0">
                            <div class="text-center text-gray-500 py-12">
                                <i class="fas fa-inbox text-6xl mb-4"></i>
                                <h3 class="text-xl font-medium mb-2">No requests yet</h3>
                                <p>Event organizers will send you service requests here</p>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Modals -->
    
    <!-- Login Modal -->
    <div x-show="showLogin" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4" @click.away="showLogin = false">
            <h2 class="text-2xl font-bold mb-6">Login</h2>
            <form @submit.prevent="login()">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input x-model="loginForm.email" type="email" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input x-model="loginForm.password" type="password" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                </div>
                <div class="flex justify-between">
                    <button type="button" @click="showLogin = false" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">
                        Cancel
                    </button>
                    <button type="submit" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                        Login
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div x-show="showRegister" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 max-h-screen overflow-y-auto" @click.away="showRegister = false">
            <h2 class="text-2xl font-bold mb-6">Register</h2>
            <form @submit.prevent="register()">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Name</label>
                    <input x-model="registerForm.name" type="text" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input x-model="registerForm.email" type="email" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input x-model="registerForm.password" type="password" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">User Type</label>
                    <select x-model="registerForm.userType" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        <option value="">Select Type</option>
                        <option value="organizer">Event Organizer</option>
                        <option value="vendor">Service Vendor</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Emirate</label>
                    <select x-model="registerForm.location.emirate" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        <option value="">Select Emirate</option>
                        <option value="Dubai">Dubai</option>
                        <option value="Abu Dhabi">Abu Dhabi</option>
                        <option value="Sharjah">Sharjah</option>
                        <option value="Ajman">Ajman</option>
                        <option value="Ras Al Khaimah">Ras Al Khaimah</option>
                        <option value="Fujairah">Fujairah</option>
                        <option value="Umm Al Quwain">Umm Al Quwain</option>
                    </select>
                </div>

                <!-- Vendor specific fields -->
                <template x-if="registerForm.userType === 'vendor'">
                    <div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Business Name</label>
                            <input x-model="registerForm.businessName" type="text" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Category</label>
                            <select x-model="registerForm.category" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                                <option value="">Select Category</option>
                                <option value="catering">Catering</option>
                                <option value="photography">Photography</option>
                                <option value="decoration">Decoration</option>
                                <option value="entertainment">Entertainment</option>
                                <option value="audio_visual">Audio Visual</option>
                                <option value="flowers">Flowers</option>
                                <option value="transportation">Transportation</option>
                                <option value="security">Security</option>
                                <option value="venue">Venue</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                </template>

                <!-- Organizer specific fields -->
                <template x-if="registerForm.userType === 'organizer'">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Organization Type</label>
                        <select x-model="registerForm.organizationType" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <option value="">Select Type</option>
                            <option value="individual">Individual</option>
                            <option value="student">Student</option>
                            <option value="freelancer">Freelancer</option>
                            <option value="sme_owner">SME Owner</option>
                        </select>
                    </div>
                </template>

                <div class="flex justify-between">
                    <button type="button" @click="showRegister = false" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">
                        Cancel
                    </button>
                    <button type="submit" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                        Register
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Event Modal -->
    <div x-show="showCreateEvent" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto" @click.away="showCreateEvent = false">
            <h2 class="text-2xl font-bold mb-6">Create New Event</h2>
            <form @submit.prevent="createEvent()">
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Event Title</label>
                        <input x-model="eventForm.title" type="text" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Event Type</label>
                        <select x-model="eventForm.eventType" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <option value="">Select Type</option>
                            <option value="wedding">Wedding</option>
                            <option value="corporate">Corporate</option>
                            <option value="birthday">Birthday</option>
                            <option value="conference">Conference</option>
                            <option value="seminar">Seminar</option>
                            <option value="networking">Networking</option>
                            <option value="graduation">Graduation</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Start Date</label>
                        <input x-model="eventForm.date.start" type="datetime-local" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">End Date</label>
                        <input x-model="eventForm.date.end" type="datetime-local" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Expected Attendees</label>
                        <input x-model="eventForm.attendees.expected" type="number" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Total Budget (AED)</label>
                        <input x-model="eventForm.totalBudget" type="number" required class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Description</label>
                    <textarea x-model="eventForm.description" rows="3" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Venue Address</label>
                    <input x-model="eventForm.location.address" type="text" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                </div>

                <div class="flex justify-between">
                    <button type="button" @click="showCreateEvent = false" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">
                        Cancel
                    </button>
                    <button type="submit" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                        Create Event
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div x-show="showEventDetails" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto" @click.away="showEventDetails = false">
            <template x-if="selectedEvent">
                <div>
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-3xl font-bold" x-text="selectedEvent.title"></h2>
                            <p class="text-gray-600" x-text="selectedEvent.description"></p>
                        </div>
                        <button @click="showEventDetails = false" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <!-- Event Info -->
                    <div class="grid md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-bold mb-3">Event Details</h3>
                            <div class="space-y-2 text-sm">
                                <div><span class="text-gray-600">Date:</span> <span x-text="formatDate(selectedEvent.date.start) + ' - ' + formatDate(selectedEvent.date.end)"></span></div>
                                <div><span class="text-gray-600">Attendees:</span> <span x-text="selectedEvent.attendees.expected"></span></div>
                                <div><span class="text-gray-600">Budget:</span> AED <span x-text="selectedEvent.totalBudget.toLocaleString()"></span></div>
                                <div><span class="text-gray-600">Location:</span> <span x-text="selectedEvent.location?.address || 'TBD'"></span></div>
                                <div><span class="text-gray-600">Status:</span> <span :class="getStatusColor(selectedEvent.status)" class="px-2 py-1 rounded text-xs capitalize" x-text="selectedEvent.status"></span></div>
                            </div>
                        </div>

                        <!-- Budget Breakdown -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-bold mb-3">Budget Breakdown</h3>
                            <template x-if="selectedEvent.budgetCategories && selectedEvent.budgetCategories.length > 0">
                                <div class="space-y-3">
                                    <template x-for="category in selectedEvent.budgetCategories" :key="category.name">
                                        <div>
                                            <div class="flex justify-between text-sm mb-1">
                                                <span x-text="category.name"></span>
                                                <span>AED <span x-text="category.spent.toLocaleString()"></span> / <span x-text="category.allocated.toLocaleString()"></span></span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-yellow-600 h-2 rounded-full" :style="'width: ' + Math.min((category.spent / category.allocated) * 100, 100) + '%'"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                            <template x-if="!selectedEvent.budgetCategories || selectedEvent.budgetCategories.length === 0">
                                <p class="text-gray-500 text-sm">No budget breakdown set up yet</p>
                            </template>
                        </div>
                    </div>

                    <!-- Vendor Requests -->
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">Vendor Requests</h3>
                            <button @click="showVendorRequestModal = true" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                <i class="fas fa-plus mr-2"></i>Add Vendor Request
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <template x-for="request in selectedEvent.vendorRequests" :key="request._id">
                                <div class="border rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-3">
                                        <div>
                                            <h4 class="font-medium" x-text="request.vendor?.businessName || request.vendor?.name"></h4>
                                            <p class="text-sm text-gray-600" x-text="request.service"></p>
                                        </div>
                                        <span :class="getRequestStatusColor(request.status)" class="px-2 py-1 rounded text-xs capitalize" x-text="request.status"></span>
                                    </div>
                                    
                                    <div class="grid md:grid-cols-3 gap-4 text-sm">
                                        <div>
                                            <span class="text-gray-600">Requested:</span>
                                            <span class="ml-1">AED <span x-text="request.requestedPrice?.toLocaleString() || 'N/A'"></span></span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">Quoted:</span>
                                            <span class="ml-1">AED <span x-text="request.quotedPrice?.toLocaleString() || 'N/A'"></span></span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">Final:</span>
                                            <span class="ml-1">AED <span x-text="request.finalPrice?.toLocaleString() || 'N/A'"></span></span>
                                        </div>
                                    </div>

                                    <template x-if="request.notes">
                                        <p class="text-sm text-gray-600 mt-2" x-text="request.notes"></p>
                                    </template>
                                    
                                    <div class="flex space-x-2 mt-3">
                                        <button @click="contactVendorFromEvent(request.vendor)" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                            <i class="fas fa-message mr-1"></i>Message
                                        </button>
                                        <template x-if="request.status === 'accepted' && !request.finalPrice">
                                            <button @click="finalizeVendorRequest(request)" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                                <i class="fas fa-handshake mr-1"></i>Finalize
                                            </button>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Event Notes -->
                    <div>
                        <h3 class="text-xl font-bold mb-4">Event Notes</h3>
                        <div class="space-y-3 mb-4">
                            <template x-for="note in selectedEvent.notes" :key="note._id">
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <p x-text="note.content"></p>
                                    <p class="text-xs text-gray-500 mt-1">
                                        by <span x-text="note.createdBy?.name"></span> - <span x-text="formatDate(note.createdAt)"></span>
                                    </p>
                                </div>
                            </template>
                        </div>
                        
                        <div class="flex space-x-2">
                            <input x-model="newEventNote" @keyup.enter="addEventNote()" type="text" placeholder="Add a note..." class="flex-1 border rounded-lg px-3 py-2">
                            <button @click="addEventNote()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                Add Note
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Vendor Details Modal -->
    <div x-show="showVendorDetails" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto" @click.away="showVendorDetails = false">
            <template x-if="selectedVendor">
                <div>
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-3xl font-bold" x-text="selectedVendor.businessName || selectedVendor.name"></h2>
                            <p class="text-gray-600 capitalize" x-text="selectedVendor.category?.replace('_', ' ')"></p>
                            <div class="flex items-center mt-2">
                                <div class="flex star-rating">
                                    <template x-for="i in 5" :key="i">
                                        <i :class="i <= selectedVendor.rating.average ? 'fas fa-star' : 'far fa-star'"></i>
                                    </template>
                                </div>
                                <span class="ml-2 text-gray-600">(<span x-text="selectedVendor.rating.count"></span> reviews)</span>
                            </div>
                        </div>
                        <button @click="showVendorDetails = false" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <div class="grid md:grid-cols-3 gap-6">
                        <!-- Vendor Info -->
                        <div class="md:col-span-2 space-y-6">
                            <div>
                                <h3 class="text-xl font-bold mb-3">About</h3>
                                <p class="text-gray-600" x-text="selectedVendor.profile?.bio || 'No description available'"></p>
                            </div>

                            <div>
                                <h3 class="text-xl font-bold mb-3">Services</h3>
                                <div class="flex flex-wrap gap-2">
                                    <template x-for="service in selectedVendor.services" :key="service">
                                        <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm" x-text="service"></span>
                                    </template>
                                </div>
                            </div>

                            <div>
                                <h3 class="text-xl font-bold mb-3">Portfolio</h3>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <template x-for="work in selectedVendor.portfolio" :key="work.title">
                                        <div class="border rounded-lg p-4">
                                            <div class="h-32 bg-gray-200 rounded-lg mb-3 flex items-center justify-center">
                                                <i class="fas fa-image text-gray-400 text-2xl"></i>
                                            </div>
                                            <h4 class="font-medium" x-text="work.title"></h4>
                                            <p class="text-sm text-gray-600" x-text="work.description"></p>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Reviews -->
                            <div>
                                <h3 class="text-xl font-bold mb-3">Reviews</h3>
                                <div class="space-y-4">
                                    <template x-for="review in vendorReviews" :key="review._id">
                                        <div class="border rounded-lg p-4">
                                            <div class="flex items-start justify-between mb-2">
                                                <div>
                                                    <div class="flex items-center mb-1">
                                                        <div class="flex star-rating">
                                                            <template x-for="i in 5" :key="i">
                                                                <i :class="i <= review.rating ? 'fas fa-star' : 'far fa-star'"></i>
                                                            </template>
                                                        </div>
                                                        <span class="ml-2 font-medium" x-text="review.reviewer.name"></span>
                                                    </div>
                                                    <p class="text-gray-600" x-text="review.comment"></p>
                                                </div>
                                                <span class="text-sm text-gray-500" x-text="formatDate(review.createdAt)"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Info -->
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="font-bold mb-3">Contact Information</h3>
                                <div class="space-y-2 text-sm">
                                    <div><span class="text-gray-600">Location:</span> <span x-text="selectedVendor.location.emirate"></span></div>
                                    <template x-if="selectedVendor.profile?.phone">
                                        <div><span class="text-gray-600">Phone:</span> <span x-text="selectedVendor.profile.phone"></span></div>
                                    </template>
                                    <template x-if="selectedVendor.profile?.whatsapp">
                                        <div><span class="text-gray-600">WhatsApp:</span> <span x-text="selectedVendor.profile.whatsapp"></span></div>
                                    </template>
                                    <div><span class="text-gray-600">Email:</span> <span x-text="selectedVendor.email"></span></div>
                                </div>
                            </div>

                            <template x-if="selectedVendor.pricing?.priceRange">
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h3 class="font-bold mb-3">Pricing</h3>
                                    <div class="text-sm">
                                        <span class="text-gray-600">Price Range:</span>
                                        <div class="text-lg font-medium">
                                            AED <span x-text="selectedVendor.pricing.priceRange.min?.toLocaleString()"></span>
                                            <template x-if="selectedVendor.pricing.priceRange.max">
                                                - <span x-text="selectedVendor.pricing.priceRange.max?.toLocaleString()"></span>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <div class="space-y-3">
                                <button @click="contactVendor(selectedVendor)" class="w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700">
                                    <i class="fas fa-message mr-2"></i>Send Message
                                </button>
                                <button @click="requestVendor(selectedVendor)" class="w-full bg-yellow-600 text-white px-4 py-3 rounded-lg hover:bg-yellow-700">
                                    <i class="fas fa-handshake mr-2"></i>Request Service
                                </button>
                                <template x-if="user.userType === 'organizer'">
                                    <button @click="showReviewModal = true" class="w-full bg-orange-600 text-white px-4 py-3 rounded-lg hover:bg-orange-700">
                                        <i class="fas fa-star mr-2"></i>Write Review
                                    </button>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Venue Details Modal -->
    <div x-show="showVenueDetails" x-cloak
        class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto"
            @click.away="showVenueDetails = false">
            <template x-if="selectedVenue">
                <div>
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-3xl font-bold" x-text="selectedVenue.name"></h2>
                            <p class="text-gray-600 capitalize" x-text="selectedVenue.venueType"></p>
                            <div class="flex items-center mt-2">
                                <div class="flex star-rating">
                                    <template x-for="i in 5" :key="i">
                                        <i :class="i <= selectedVenue.rating.average ? 'fas fa-star' : 'far fa-star'"></i>
                                    </template>
                                </div>
                                <span class="ml-2 text-gray-600">(<span x-text="selectedVenue.rating.count"></span>
                                    reviews)</span>
                            </div>
                        </div>
                        <button @click="showVenueDetails = false" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
    
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="md:col-span-2 space-y-6">
                            <!-- FIXED: Dynamic Image Gallery -->
                            <div x-data="{ currentImage: 0 }" class="space-y-4">
                                <!-- Check if venue has images -->
                                <template x-if="selectedVenue.images && selectedVenue.images.length > 0">
                                    <div>
                                        <!-- Main Image Display -->
                                        <div class="relative h-64 bg-gray-200 rounded-lg overflow-hidden">
                                            <img :src="selectedVenue.images[currentImage].url"
                                                :alt="selectedVenue.images[currentImage].caption || 'Venue image'"
                                                class="w-full h-full object-cover">
    
                                            <!-- Navigation arrows (show only if multiple images) -->
                                            <template x-if="selectedVenue.images.length > 1">
                                                <div class="absolute inset-0 flex items-center justify-between p-4">
                                                    <button
                                                        @click="currentImage = currentImage > 0 ? currentImage - 1 : selectedVenue.images.length - 1"
                                                        class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-opacity">
                                                        <i class="fas fa-chevron-left"></i>
                                                    </button>
                                                    <button
                                                        @click="currentImage = currentImage < selectedVenue.images.length - 1 ? currentImage + 1 : 0"
                                                        class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-opacity">
                                                        <i class="fas fa-chevron-right"></i>
                                                    </button>
                                                </div>
                                            </template>
    
                                            <!-- Image caption overlay -->
                                            <div
                                                class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-transparent to-transparent p-4">
                                                <p class="text-white text-sm"
                                                    x-text="selectedVenue.images[currentImage].caption || 'Venue image'">
                                                </p>
                                            </div>
    
                                            <!-- Image counter -->
                                            <template x-if="selectedVenue.images.length > 1">
                                                <div
                                                    class="absolute top-4 right-4 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm">
                                                    <span x-text="currentImage + 1"></span>/<span
                                                        x-text="selectedVenue.images.length"></span>
                                                </div>
                                            </template>
                                        </div>
    
                                        <!-- Thumbnail strip (show only if multiple images) -->
                                        <template x-if="selectedVenue.images.length > 1">
                                            <div class="flex space-x-2 overflow-x-auto pb-2">
                                                <template x-for="(image, index) in selectedVenue.images" :key="index">
                                                    <button @click="currentImage = index"
                                                        :class="currentImage === index ? 'ring-2 ring-yellow-500' : 'ring-1 ring-gray-300'"
                                                        class="flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden hover:ring-2 hover:ring-yellow-400 transition-all">
                                                        <img :src="image.url" :alt="image.caption || 'Venue thumbnail'"
                                                            class="w-full h-full object-cover">
                                                    </button>
                                                </template>
                                            </div>
                                        </template>
                                    </div>
                                </template>
    
                                <!-- Fallback if no images available -->
                                <template x-if="!selectedVenue.images || selectedVenue.images.length === 0">
                                    <div
                                        class="h-64 bg-gradient-to-br from-yellow-400 to-purple-500 rounded-lg flex items-center justify-center">
                                        <div class="text-center">
                                            <i class="fas fa-building text-white text-6xl mb-4"></i>
                                            <p class="text-white text-lg font-medium">No images available</p>
                                            <p class="text-white text-sm opacity-75">Contact venue for more photos</p>
                                        </div>
                                    </div>
                                </template>
                            </div>
    
                            <!-- Description -->
                            <div>
                                <h3 class="text-xl font-bold mb-3">Description</h3>
                                <p class="text-gray-600" x-text="selectedVenue.description"></p>
                            </div>
    
                            <!-- Amenities -->
                            <template x-if="selectedVenue.amenities && selectedVenue.amenities.length > 0">
                                <div>
                                    <h3 class="text-xl font-bold mb-3">Amenities</h3>
                                    <div class="grid grid-cols-2 gap-2">
                                        <template x-for="amenity in selectedVenue.amenities" :key="amenity">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-check text-green-500"></i>
                                                <span class="text-sm" x-text="amenity"></span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
    
                        <!-- Venue Details Sidebar -->
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="font-bold mb-3">Venue Details</h3>
                                <div class="space-y-2 text-sm">
                                    <div><span class="text-gray-600">Location:</span> <span
                                            x-text="selectedVenue.location.emirate"></span></div>
                                    <div><span class="text-gray-600">Address:</span> <span
                                            x-text="selectedVenue.location.address"></span></div>
                                    <div><span class="text-gray-600">Capacity:</span> <span
                                            x-text="selectedVenue.capacity.minimum + ' - ' + selectedVenue.capacity.maximum + ' guests'"></span>
                                    </div>
                                    <div><span class="text-gray-600">Type:</span> <span class="capitalize"
                                            x-text="selectedVenue.venueType"></span></div>
                                </div>
                            </div>
    
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="font-bold mb-3">Pricing</h3>
                                <div class="text-lg font-medium">
                                    AED <span x-text="selectedVenue.pricing.basePrice.toLocaleString()"></span>
                                    <span class="text-sm text-gray-600"
                                        x-text="'per ' + selectedVenue.pricing.priceType.replace('_', ' ')"></span>
                                </div>
                            </div>
    
                            <template x-if="selectedVenue.contact">
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h3 class="font-bold mb-3">Contact</h3>
                                    <div class="space-y-2 text-sm">
                                        <template x-if="selectedVenue.contact.manager">
                                            <div><span class="text-gray-600">Manager:</span> <span
                                                    x-text="selectedVenue.contact.manager"></span></div>
                                        </template>
                                        <template x-if="selectedVenue.contact.phone">
                                            <div><span class="text-gray-600">Phone:</span> <span
                                                    x-text="selectedVenue.contact.phone"></span></div>
                                        </template>
                                        <template x-if="selectedVenue.contact.email">
                                            <div><span class="text-gray-600">Email:</span> <span
                                                    x-text="selectedVenue.contact.email"></span></div>
                                        </template>
                                    </div>
                                </div>
                            </template>
    
                            <div class="space-y-3">
                                <button @click="bookVenue(selectedVenue)"
                                    class="w-full bg-yellow-600 text-white px-4 py-3 rounded-lg hover:bg-yellow-700">
                                    <i class="fas fa-calendar-check mr-2"></i>Book Venue
                                </button>
                                <button @click="contactVenueManager(selectedVenue)"
                                    class="w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700">
                                    <i class="fas fa-phone mr-2"></i>Contact Manager
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>    

    <!-- Vendor Request Modal -->
    <div x-show="showVendorRequestModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4" @click.away="showVendorRequestModal = false">
            <h2 class="text-2xl font-bold mb-6">Send Vendor Request</h2>
            <form @submit.prevent="sendVendorRequest()">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Select Vendor</label>
                    <select x-model="vendorRequestForm.vendorId" required class="w-full border rounded-lg px-3 py-2">
                        <option value="">Choose a vendor...</option>
                        <template x-for="vendor in vendors" :key="vendor._id">
                            <option :value="vendor._id" x-text="vendor.businessName || vendor.name"></option>
                        </template>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Service Required</label>
                    <input x-model="vendorRequestForm.service" type="text" required class="w-full border rounded-lg px-3 py-2">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Requested Price (AED)</label>
                    <input x-model="vendorRequestForm.requestedPrice" type="number" class="w-full border rounded-lg px-3 py-2">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Notes</label>
                    <textarea x-model="vendorRequestForm.notes" rows="3" class="w-full border rounded-lg px-3 py-2"></textarea>
                </div>
                <div class="flex justify-between">
                    <button type="button" @click="showVendorRequestModal = false" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg">
                        Cancel
                    </button>
                    <button type="submit" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                        Send Request
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Quote Modal -->
    <div x-show="showQuoteModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4" @click.away="showQuoteModal = false">
            <h2 class="text-2xl font-bold mb-6">Send Quote</h2>
            <form @submit.prevent="sendQuote()">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Services</label>
                    <textarea x-model="quoteForm.services" rows="3" placeholder="List the services included..." class="w-full border rounded-lg px-3 py-2"></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Total Price (AED)</label>
                    <input x-model="quoteForm.totalPrice" type="number" required class="w-full border rounded-lg px-3 py-2">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Valid Until</label>
                    <input x-model="quoteForm.validUntil" type="date" required class="w-full border rounded-lg px-3 py-2">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Terms & Conditions</label>
                    <textarea x-model="quoteForm.terms" rows="3" class="w-full border rounded-lg px-3 py-2"></textarea>
                </div>
                <div class="flex justify-between">
                    <button type="button" @click="showQuoteModal = false" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg">
                        Cancel
                    </button>
                    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                        Send Quote
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Review Modal -->
    <div x-show="showReviewModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4" @click.away="showReviewModal = false">
            <h2 class="text-2xl font-bold mb-6">Write Review</h2>
            <form @submit.prevent="submitReview()">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Rating</label>
                    <div class="flex space-x-2">
                        <template x-for="i in 5" :key="i">
                            <button type="button" @click="reviewForm.rating = i" :class="i <= reviewForm.rating ? 'text-yellow-400' : 'text-gray-300'" class="text-2xl hover:text-yellow-400">
                                <i class="fas fa-star"></i>
                            </button>
                        </template>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Event</label>
                    <select x-model="reviewForm.eventId" required class="w-full border rounded-lg px-3 py-2">
                        <option value="">Select event...</option>
                        <template x-for="event in events" :key="event._id">
                            <option :value="event._id" x-text="event.title"></option>
                        </template>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Comment</label>
                    <textarea x-model="reviewForm.comment" rows="4" class="w-full border rounded-lg px-3 py-2" placeholder="Share your experience..."></textarea>
                </div>
                <div class="flex justify-between">
                    <button type="button" @click="showReviewModal = false" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg">
                        Cancel
                    </button>
                    <button type="submit" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700">
                        Submit Review
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Budget Recommendations Modal -->
    <div x-show="showBudgetModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto" @click.away="showBudgetModal = false">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Budget Recommendations</h2>
                <button @click="showBudgetModal = false" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <template x-if="budgetRecommendations">
                <div>
                    <div class="mb-6">
                        <h3 class="text-lg font-bold mb-3">Recommended Budget Breakdown</h3>
                        <div class="space-y-3">
                            <template x-for="rec in budgetRecommendations.recommendations" :key="rec.category">
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex-1">
                                        <h4 class="font-medium" x-text="rec.category"></h4>
                                        <p class="text-sm text-gray-600" x-text="rec.description"></p>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold">AED <span x-text="rec.amount.toLocaleString()"></span></div>
                                        <div class="text-sm text-gray-500"><span x-text="rec.percentage"></span>%</div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-bold mb-3">Cost-Saving Tips</h3>
                        <ul class="space-y-2">
                            <template x-for="tip in budgetRecommendations.costSavingTips" :key="tip">
                                <li class="flex items-start space-x-2">
                                    <i class="fas fa-lightbulb text-yellow-500 mt-1"></i>
                                    <span class="text-sm" x-text="tip"></span>
                                </li>
                            </template>
                        </ul>
                    </div>

                    <div class="bg-yellow-50 rounded-lg p-4">
                        <h4 class="font-bold text-yellow-800 mb-2">Total Budget: AED <span x-text="budgetRecommendations.totalBudget.toLocaleString()"></span></h4>
                        <p class="text-sm text-yellow-600">These recommendations are based on typical UAE event costs and can be adjusted based on your preferences.</p>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- File Upload Modal -->
    <div x-show="showFileUpload" x-cloak class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4" @click.away="showFileUpload = false">
            <h2 class="text-2xl font-bold mb-6">Upload File</h2>
            <div class="mb-6">
                <input type="file" id="fileInput" @change="handleFileSelect($event)" class="w-full border rounded-lg px-3 py-2">
                <p class="text-sm text-gray-500 mt-2">Maximum file size: 10MB</p>
            </div>
            <div class="flex justify-between">
                <button @click="showFileUpload = false" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg">
                    Cancel
                </button>
                <button @click="uploadFile()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                    Upload
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div x-show="loading" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600 mx-auto mb-4"></div>
            <p>Loading...</p>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div x-show="toast.show" x-cloak 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-2"
         class="fixed top-20 right-4 z-50">
        <div :class="toast.type === 'success' ? 'bg-green-500' : 'bg-red-500'" 
             class="text-white px-6 py-3 rounded-lg shadow-lg">
            <p x-text="toast.message"></p>
        </div>
    </div>

    <script>
        function pocketWatcherApp() {
            return {
                // State
                isAuthenticated: false,
                user: {},
                token: '',
                loading: false,
                activeTab: 'dashboard',
                
                // Modal states
                showLogin: false,
                showRegister: false,
                showCreateEvent: false,
                showEventDetails: false,
                showVendorDetails: false,
                showVenueDetails: false,
                showVendorRequestModal: false,
                showQuoteModal: false,
                showReviewModal: false,
                showBudgetModal: false,
                showFileUpload: false,
                showNotifications: false,
                showSearchResults: false,
                showAddPortfolio: false,
                
                // Selected items
                selectedEvent: null,
                selectedVendor: null,
                selectedVenue: null,
                selectedConversation: null,
                
                // Forms
                loginForm: { email: '', password: '' },
                registerForm: { 
                    name: '', email: '', password: '', userType: '', 
                    location: { emirate: '' }, businessName: '', category: '', organizationType: '' 
                },
                eventForm: {
                    title: '', description: '', eventType: '', 
                    date: { start: '', end: '' },
                    attendees: { expected: 0 },
                    totalBudget: 0,
                    location: { address: '' }
                },
                vendorRequestForm: {
                    vendorId: '', service: '', requestedPrice: '', notes: ''
                },
                quoteForm: {
                    services: '', totalPrice: '', validUntil: '', terms: ''
                },
                reviewForm: {
                    rating: 5, eventId: '', comment: ''
                },
                
                // Data
                events: [],
                vendors: [],
                venues: [],
                conversations: [],
                currentMessages: [],
                vendorRequests: [],
                vendorReviews: [],
                newMessage: '',
                newEventNote: '',
                newService: '',
                analytics: {},
                notifications: [],
                unreadNotifications: 0,
                budgetRecommendations: null,
                
                // Search
                vendorSearch: { query: '', category: '', emirate: '', priceMin: '', priceMax: '' },
                venueSearch: { emirate: '', type: '', minCapacity: '', maxCapacity: '' },
                globalSearch: { query: '', results: null },
                
                // File upload
                selectedFile: null,
                
                // Toast
                toast: { show: false, message: '', type: 'success' },
                
                // API Base URL
                apiUrl: 'https://pocketwatcher-backend.onrender.com/api',
                
                // Initialize
                async init() {
                    this.token = localStorage.getItem('token');
                    if (this.token) {
                        await this.verifyToken();
                    }
                    
                    // Set up real-time updates
                    this.setupRealTimeUpdates();
                },
                
                setupRealTimeUpdates() {
                    // Poll for new notifications every 30 seconds
                    if (this.isAuthenticated) {
                        setInterval(() => {
                            this.loadNotifications();
                            this.loadConversations();
                        }, 30000);
                    }
                },
                
                // Authentication
                async login() {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/auth/login`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.loginForm)
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.token = data.token;
                            this.user = data.user;
                            this.isAuthenticated = true;
                            localStorage.setItem('token', this.token);
                            this.showLogin = false;
                            this.loginForm = { email: '', password: '' };
                            await this.loadDashboardData();
                            this.setupRealTimeUpdates();
                            this.showToast('Login successful!', 'success');
                        } else {
                            this.showToast(data.message, 'error');
                        }
                    } catch (error) {
                        this.showToast('Login failed', 'error');
                    }
                    this.loading = false;
                },
                
                async register() {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/auth/register`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.registerForm)
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.token = data.token;
                            this.user = data.user;
                            this.isAuthenticated = true;
                            localStorage.setItem('token', this.token);
                            this.showRegister = false;
                            this.resetRegisterForm();
                            await this.loadDashboardData();
                            this.setupRealTimeUpdates();
                            this.showToast('Registration successful!', 'success');
                        } else {
                            this.showToast(data.message, 'error');
                        }
                    } catch (error) {
                        this.showToast('Registration failed', 'error');
                    }
                    this.loading = false;
                },
                
                async verifyToken() {
                    try {
                        const response = await fetch(`${this.apiUrl}/users/profile`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.user = data.user;
                            this.isAuthenticated = true;
                            await this.loadDashboardData();
                        } else {
                            this.logout();
                        }
                    } catch (error) {
                        this.logout();
                    }
                },
                
                logout() {
                    this.isAuthenticated = false;
                    this.user = {};
                    this.token = '';
                    localStorage.removeItem('token');
                    this.activeTab = 'dashboard';
                    this.showToast('Logged out successfully', 'success');
                },
                
                // Data Loading
                async loadDashboardData() {
                    await Promise.all([
                        this.loadAnalytics(),
                        this.loadEvents(),
                        this.loadVendors(),
                        this.loadVenues(),
                        this.loadConversations(),
                        this.loadNotifications(),
                        this.loadVendorRequests()
                    ]);
                },
                
                async loadAnalytics() {
                    try {
                        const response = await fetch(`${this.apiUrl}/analytics/dashboard`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        const data = await response.json();
                        if (data.success) {
                            const rawAnalytics = data.analytics;
                            
                            if (this.user.userType === 'organizer') {
                                this.analytics = {
                                    'Total Events': { value: rawAnalytics.totalEvents || 0, label: 'Total Events' },
                                    'Completed': { value: rawAnalytics.completedEvents || 0, label: 'Completed Events' },
                                    'Total Budget': { value: `AED ${(rawAnalytics.totalBudget || 0).toLocaleString()}`, label: 'Total Budget' },
                                    'Savings': { value: `AED ${(rawAnalytics.savings || 0).toLocaleString()}`, label: 'Total Savings' }
                                };
                            } else {
                                this.analytics = {
                                    'Total Requests': { value: rawAnalytics.totalRequests || 0, label: 'Total Requests' },
                                    'Accepted': { value: rawAnalytics.acceptedRequests || 0, label: 'Accepted Jobs' },
                                    'Completed': { value: rawAnalytics.completedJobs || 0, label: 'Completed Jobs' },
                                    'Earnings': { value: `AED ${(rawAnalytics.totalEarnings || 0).toLocaleString()}`, label: 'Total Earnings' }
                                };
                            }
                        }
                    } catch (error) {
                        console.error('Failed to load analytics:', error);
                    }
                },
                
                async loadEvents() {
                    try {
                        const response = await fetch(`${this.apiUrl}/events`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.events = data.events;
                        }
                    } catch (error) {
                        console.error('Failed to load events:', error);
                    }
                },
                
                async loadVendors() {
                    try {
                        const response = await fetch(`${this.apiUrl}/vendors`);
                        const data = await response.json();
                        if (data.success) {
                            this.vendors = data.vendors;
                        }
                    } catch (error) {
                        console.error('Failed to load vendors:', error);
                    }
                },
                
                async loadVenues() {
                    try {
                        const response = await fetch(`${this.apiUrl}/venues`);
                        const data = await response.json();
                        if (data.success) {
                            this.venues = data.venues;
                        }
                    } catch (error) {
                        console.error('Failed to load venues:', error);
                    }
                },
                
                async loadConversations() {
                    if (!this.isAuthenticated) return;
                    try {
                        const response = await fetch(`${this.apiUrl}/conversations`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.conversations = data.conversations;
                        }
                    } catch (error) {
                        console.error('Failed to load conversations:', error);
                    }
                },
                
                async loadNotifications() {
                    if (!this.isAuthenticated) return;
                    try {
                        const response = await fetch(`${this.apiUrl}/notifications`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.notifications = data.notifications;
                            this.unreadNotifications = this.notifications.length;
                        }
                    } catch (error) {
                        console.error('Failed to load notifications:', error);
                    }
                },
                
                async loadVendorRequests() {
                    if (!this.isAuthenticated || this.user.userType !== 'vendor') return;
                    try {
                        // Load events where vendor has requests
                        const response = await fetch(`${this.apiUrl}/events`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.vendorRequests = [];
                            data.events.forEach(event => {
                                event.vendorRequests.forEach(request => {
                                    if (request.vendor._id === this.user.id) {
                                        this.vendorRequests.push({
                                            ...request,
                                            event: event,
                                            eventId: event._id,
                                            requestId: request._id
                                        });
                                    }
                                });
                            });
                        }
                    } catch (error) {
                        console.error('Failed to load vendor requests:', error);
                    }
                },
                
                // Event Management
                async createEvent() {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/events`, {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}` 
                            },
                            body: JSON.stringify(this.eventForm)
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.events.unshift(data.event);
                            this.showCreateEvent = false;
                            this.resetEventForm();
                            this.showToast('Event created successfully!', 'success');
                        } else {
                            this.showToast(data.message, 'error');
                        }
                    } catch (error) {
                        this.showToast('Failed to create event', 'error');
                    }
                    this.loading = false;
                },
                
                async viewEventDetails(event) {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/events/${event._id}`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.selectedEvent = data.event;
                            this.showEventDetails = true;
                        }
                    } catch (error) {
                        this.showToast('Failed to load event details', 'error');
                    }
                    this.loading = false;
                },
                
                editEvent(event) {
                    this.eventForm = {
                        title: event.title,
                        description: event.description,
                        eventType: event.eventType,
                        date: {
                            start: event.date.start.slice(0, 16),
                            end: event.date.end.slice(0, 16)
                        },
                        attendees: { expected: event.attendees.expected },
                        totalBudget: event.totalBudget,
                        location: { address: event.location?.address || '' }
                    };
                    this.selectedEvent = event;
                    this.showCreateEvent = true;
                },
                
                // Vendor Management
                async viewVendorDetails(vendor) {
                    this.selectedVendor = vendor;
                    this.showVendorDetails = true;
                    await this.loadVendorReviews(vendor._id);
                },
                
                async loadVendorReviews(vendorId) {
                    try {
                        const response = await fetch(`${this.apiUrl}/reviews/${vendorId}`);
                        const data = await response.json();
                        if (data.success) {
                            this.vendorReviews = data.reviews;
                        }
                    } catch (error) {
                        console.error('Failed to load reviews:', error);
                    }
                },
                
                async requestVendor(vendor) {
                    if (this.events.length === 0) {
                        this.showToast('Please create an event first', 'error');
                        return;
                    }
                    this.vendorRequestForm.vendorId = vendor._id;
                    this.showVendorRequestModal = true;
                },
                
                async sendVendorRequest() {
                    if (!this.selectedEvent) {
                        this.showToast('Please select an event first', 'error');
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/events/${this.selectedEvent._id}/vendor-requests`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify(this.vendorRequestForm)
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.showVendorRequestModal = false;
                            this.resetVendorRequestForm();
                            this.showToast('Vendor request sent successfully!', 'success');
                            await this.loadEvents();
                        } else {
                            this.showToast(data.message, 'error');
                        }
                    } catch (error) {
                        this.showToast('Failed to send vendor request', 'error');
                    }
                    this.loading = false;
                },
                
                async respondToRequest(request, status) {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/events/${request.eventId}/vendor-requests/${request.requestId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({ status })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            await this.loadVendorRequests();
                            this.showToast(`Request ${status} successfully!`, 'success');
                        } else {
                            this.showToast(data.message, 'error');
                        }
                    } catch (error) {
                        this.showToast('Failed to update request', 'error');
                    }
                    this.loading = false;
                },
                
                // Venue Management
                async viewVenueDetails(venue) {
                    this.selectedVenue = venue;
                    this.showVenueDetails = true;
                },
                
                bookVenue(venue) {
                    this.showToast(`Venue booking would open for: ${venue.name}`, 'success');
                },
                
                // Profile Management
                async updateProfile() {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/users/profile`, {
                            method: 'PUT',
                            headers: { 
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}` 
                            },
                            body: JSON.stringify(this.user)
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.user = data.user;
                            this.showToast('Profile updated successfully!', 'success');
                        } else {
                            this.showToast(data.message, 'error');
                        }
                    } catch (error) {
                        this.showToast('Failed to update profile', 'error');
                    }
                    this.loading = false;
                },
                
                addService() {
                    if (!this.newService.trim()) return;
                    if (!this.user.services) this.user.services = [];
                    this.user.services.push(this.newService.trim());
                    this.newService = '';
                },
                
                removeService(index) {
                    this.user.services.splice(index, 1);
                },
                
                // Messaging
                async selectConversation(conversation) {
                    this.selectedConversation = conversation;
                    await this.loadMessages(conversation.participant._id);
                },
                
                async loadMessages(recipientId) {
                    try {
                        const response = await fetch(`${this.apiUrl}/messages?recipientId=${recipientId}`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.currentMessages = data.messages;
                            // Scroll to bottom
                            this.$nextTick(() => {
                                const container = document.getElementById('messagesContainer');
                                if (container) {
                                    container.scrollTop = container.scrollHeight;
                                }
                            });
                        }
                    } catch (error) {
                        console.error('Failed to load messages:', error);
                    }
                },
                
                async sendMessage() {
                    if (!this.newMessage.trim() || !this.selectedConversation) return;
                    
                    try {
                        const response = await fetch(`${this.apiUrl}/messages`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                recipientId: this.selectedConversation.participant._id,
                                content: this.newMessage
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.currentMessages.push(data.message);
                            this.newMessage = '';
                            // Scroll to bottom
                            this.$nextTick(() => {
                                const container = document.getElementById('messagesContainer');
                                if (container) {
                                    container.scrollTop = container.scrollHeight;
                                }
                            });
                        }
                    } catch (error) {
                        this.showToast('Failed to send message', 'error');
                    }
                },
                
                async sendQuote() {
                    if (!this.selectedConversation) return;
                    
                    try {
                        const response = await fetch(`${this.apiUrl}/messages`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                recipientId: this.selectedConversation.participant._id,
                                content: `Quote: AED ${this.quoteForm.totalPrice}`,
                                messageType: 'quote',
                                quotation: {
                                    services: this.quoteForm.services.split('\n').filter(s => s.trim()),
                                    totalPrice: parseFloat(this.quoteForm.totalPrice),
                                    validUntil: this.quoteForm.validUntil,
                                    terms: this.quoteForm.terms
                                }
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.currentMessages.push(data.message);
                            this.showQuoteModal = false;
                            this.resetQuoteForm();
                            this.showToast('Quote sent successfully!', 'success');
                        }
                    } catch (error) {
                        this.showToast('Failed to send quote', 'error');
                    }
                },
                
                contactVendor(vendor) {
                    // Start a conversation with the vendor
                    const existingConversation = this.conversations.find(c => 
                        c.participant._id === vendor._id
                    );
                    
                    if (existingConversation) {
                        this.selectConversation(existingConversation);
                    } else {
                        // Create new conversation object
                        this.selectedConversation = {
                            participant: vendor
                        };
                        this.currentMessages = [];
                    }
                    this.activeTab = 'messages';
                },
                
                contactVendorFromEvent(vendor) {
                    this.contactVendor(vendor);
                    this.showEventDetails = false;
                },
                
                // Reviews
                async submitReview() {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/reviews`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                revieweeId: this.selectedVendor._id,
                                eventId: this.reviewForm.eventId,
                                rating: this.reviewForm.rating,
                                comment: this.reviewForm.comment
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.showReviewModal = false;
                            this.resetReviewForm();
                            this.showToast('Review submitted successfully!', 'success');
                            await this.loadVendorReviews(this.selectedVendor._id);
                        } else {
                            this.showToast(data.message, 'error');
                        }
                    } catch (error) {
                        this.showToast('Failed to submit review', 'error');
                    }
                    this.loading = false;
                },
                
                // Budget Recommendations
                async getBudgetRecommendations(event) {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/budget-recommendations/${event.eventType}?attendees=${event.attendees.expected}&totalBudget=${event.totalBudget}`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.budgetRecommendations = data;
                            this.showBudgetModal = true;
                        }
                    } catch (error) {
                        this.showToast('Failed to load budget recommendations', 'error');
                    }
                    this.loading = false;
                },
                
                async loadBudgetRecommendations() {
                    if (this.events.length === 0) {
                        this.showToast('Please create an event first to get budget recommendations', 'error');
                        return;
                    }
                    
                    const lastEvent = this.events[0];
                    await this.getBudgetRecommendations(lastEvent);
                },
                
                // File Upload
                handleFileSelect(event) {
                    this.selectedFile = event.target.files[0];
                },
                
                async uploadFile() {
                    if (!this.selectedFile) return;
                    
                    this.loading = true;
                    try {
                        const formData = new FormData();
                        formData.append('file', this.selectedFile);
                        
                        const response = await fetch(`${this.apiUrl}/upload`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: formData
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.showFileUpload = false;
                            this.selectedFile = null;
                            document.getElementById('fileInput').value = '';
                            
                            // Send file as message if in conversation
                            if (this.selectedConversation) {
                                await this.sendFileMessage(data);
                            }
                            
                            this.showToast('File uploaded successfully!', 'success');
                        } else {
                            this.showToast(data.message, 'error');
                        }
                    } catch (error) {
                        this.showToast('File upload failed', 'error');
                    }
                    this.loading = false;
                },
                
                async sendFileMessage(fileData) {
                    try {
                        const response = await fetch(`${this.apiUrl}/messages`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                recipientId: this.selectedConversation.participant._id,
                                content: `File: ${fileData.originalName}`,
                                messageType: 'document',
                                attachments: [{
                                    filename: fileData.originalName,
                                    url: fileData.url,
                                    type: 'document'
                                }]
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.currentMessages.push(data.message);
                        }
                    } catch (error) {
                        console.error('Failed to send file message:', error);
                    }
                },
                
                // Event Notes
                async addEventNote() {
                    if (!this.newEventNote.trim() || !this.selectedEvent) return;
                    
                    try {
                        const response = await fetch(`${this.apiUrl}/events/${this.selectedEvent._id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                notes: [
                                    ...(this.selectedEvent.notes || []),
                                    {
                                        content: this.newEventNote,
                                        createdBy: this.user.id,
                                        createdAt: new Date().toISOString()
                                    }
                                ]
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.selectedEvent = data.event;
                            this.newEventNote = '';
                            this.showToast('Note added successfully!', 'success');
                        }
                    } catch (error) {
                        this.showToast('Failed to add note', 'error');
                    }
                },
                
                async finalizeVendorRequest(request) {
                    const finalPrice = prompt('Enter final agreed price (AED):');
                    if (!finalPrice) return;
                    
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiUrl}/events/${request.eventId}/vendor-requests/${request.requestId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                finalPrice: parseFloat(finalPrice),
                                status: 'completed'
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            await this.viewEventDetails(this.selectedEvent);
                            this.showToast('Vendor request finalized!', 'success');
                        } else {
                            this.showToast(data.message, 'error');
                        }
                    } catch (error) {
                        this.showToast('Failed to finalize request', 'error');
                    }
                    this.loading = false;
                },
                
                // Utility Functions
                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },
                
                getStatusColor(status) {
                    const colors = {
                        'planning': 'bg-yellow-100 text-yellow-800',
                        'confirmed': 'bg-blue-100 text-blue-800',
                        'ongoing': 'bg-green-100 text-green-800',
                        'completed': 'bg-gray-100 text-gray-800',
                        'cancelled': 'bg-red-100 text-red-800'
                    };
                    return colors[status] || 'bg-gray-100 text-gray-800';
                },
                
                getRequestStatusColor(status) {
                    const colors = {
                        'pending': 'bg-yellow-100 text-yellow-800',
                        'accepted': 'bg-green-100 text-green-800',
                        'declined': 'bg-red-100 text-red-800',
                        'completed': 'bg-blue-100 text-blue-800'
                    };
                    return colors[status] || 'bg-gray-100 text-gray-800';
                },
                
                calculateBudgetUsed(event) {
                    if (!event.budgetCategories || event.budgetCategories.length === 0) return 0;
                    const totalSpent = event.budgetCategories.reduce((sum, cat) => sum + (cat.spent || 0), 0);
                    return Math.round((totalSpent / event.totalBudget) * 100);
                },
                
                showToast(message, type = 'success') {
                    this.toast = { show: true, message, type };
                    setTimeout(() => {
                        this.toast.show = false;
                    }, 3000);
                },
                
                // Form Reset Functions
                resetRegisterForm() {
                    this.registerForm = { 
                        name: '', email: '', password: '', userType: '', 
                        location: { emirate: '' }, businessName: '', category: '', organizationType: '' 
                    };
                },
                
                resetEventForm() {
                    this.eventForm = {
                        title: '', description: '', eventType: '', 
                        date: { start: '', end: '' },
                        attendees: { expected: 0 },
                        totalBudget: 0,
                        location: { address: '' }
                    };
                },
                
                resetVendorRequestForm() {
                    this.vendorRequestForm = {
                        vendorId: '', service: '', requestedPrice: '', notes: ''
                    };
                },
                
                resetQuoteForm() {
                    this.quoteForm = {
                        services: '', totalPrice: '', validUntil: '', terms: ''
                    };
                },
                
                resetReviewForm() {
                    this.reviewForm = {
                        rating: 5, eventId: '', comment: ''
                    };
                }
            }
        }
    </script>
</body>
</html>
